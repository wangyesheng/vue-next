{"version":3,"file":"reactivity.esm-bundler.js","sources":["../../shared/src/index.ts","../src/effect.ts","../src/baseHandlers.ts","../src/reactive.ts","../src/ref.ts","../src/computed.ts"],"sourcesContent":["import { ShapeFlags } from \"./shapeFlag\"\r\n\r\nconst isObject = (value: any) => typeof value === 'object' && value != null\r\nconst isArray = Array.isArray\r\nconst isFunction = (value: any) => typeof value === 'function'\r\nconst isNumber = (value: any) => typeof value === 'number'\r\nconst isString = (value: any) => typeof value === 'string'\r\nconst isIntegerKey = (key: any) => parseInt(key) + '' === key\r\nconst hasOwn = (target: object, key: PropertyKey) => Object.prototype.hasOwnProperty.call(target, key)\r\n\r\nexport {\r\n    isObject,\r\n    isArray,\r\n    isFunction,\r\n    isNumber,\r\n    isString,\r\n    isIntegerKey,\r\n    hasOwn,\r\n    ShapeFlags\r\n}","import { isArray, isIntegerKey } from \"@vue/shared\"\r\nimport { TrackOpTypes, TriggerOpTypes } from \"./operators\"\r\n\r\ninterface IEffectOptions {\r\n    lazy?: boolean,\r\n    scheduler?: () => void\r\n}\r\n\r\n// vue2.0 watcher\r\nfunction effect(fn: any, options: IEffectOptions = {}) {\r\n    const effect = createReactiveEffect(fn, options)\r\n    if (!options.lazy)\r\n        effect()\r\n    return effect\r\n}\r\n\r\nlet uid: number = 0\r\nlet activeEffect: any | undefined\r\nconst effectStack: any[] = []\r\nfunction createReactiveEffect(fn: any, options: IEffectOptions) {\r\n    const effect = function reactiveEffect() {\r\n        if (!effectStack.includes(effect)) {\r\n            try {\r\n                effectStack.push(effect)\r\n                activeEffect = effect\r\n                return fn() // fn 执行完才会去清除 effectStack 中的 effect，而 fn 执行时会进行 track 操作，所以 track 方法中的 activeEffect 永远都是当前运行的函数\r\n            } finally {\r\n                effectStack.pop()\r\n                activeEffect = effectStack[effectStack.length - 1]\r\n            }\r\n        }\r\n    }\r\n\r\n    effect.id = uid++\r\n    effect._isEffect = true\r\n    effect.raw = fn\r\n    effect.options = options\r\n\r\n    return effect\r\n}\r\n\r\nconst targetMap = new WeakMap\r\nfunction track(target: object, type: TrackOpTypes, key: PropertyKey) {\r\n    if (activeEffect == undefined) return\r\n\r\n    let depsMap = targetMap.get(target)\r\n    if (!depsMap) {\r\n        targetMap.set(target, (depsMap = new Map))\r\n    }\r\n\r\n    let deps = depsMap.get(key)\r\n    if (!deps) {\r\n        depsMap.set(key, deps = new Set)\r\n    }\r\n\r\n    if (!deps.has(activeEffect)) {\r\n        deps.add(activeEffect)\r\n    }\r\n}\r\n\r\n// 找属性对应的 effect 让其执行\r\nfunction trigger(\r\n    target: object,\r\n    type: TriggerOpTypes,\r\n    key: PropertyKey,\r\n    newValue?: any,\r\n    oldValue?: any\r\n) {\r\n    // debugger\r\n    const depsMap = targetMap.get(target)\r\n    // console.log(target, type, key, newValue, oldValue, targetMap)\r\n    if (!depsMap) return\r\n\r\n    const effects = new Set\r\n    const add = (effectToAdd: Set<any>) => effectToAdd.forEach(effect => effects.add(effect))\r\n\r\n    if (isArray(target)) {\r\n        if (key === 'length') {\r\n            depsMap.forEach((deps: any, _key: any) => {\r\n                if (_key == 'length' ||\r\n                    // 如果更改的长度小于收集的数组索引值，那么这个索引也需要触发 effect 重新执行\r\n                    (typeof _key !== 'symbol' && _key > newValue)\r\n                ) {\r\n                    add(deps)\r\n                }\r\n            })\r\n        }\r\n\r\n        if (type == TriggerOpTypes.ADD && isIntegerKey(key)) {\r\n            add(depsMap.get('length'))\r\n        }\r\n    } else {\r\n        if (key) {\r\n            const deps = depsMap.get(key)\r\n            if (deps) add(deps)\r\n        }\r\n    }\r\n\r\n    effects.forEach((effect: any) => {\r\n        if (effect.options.scheduler) {\r\n            effect.options.scheduler(effect)\r\n        } else {\r\n            effect()\r\n        }\r\n    })\r\n}\r\n\r\nexport {\r\n    effect,\r\n    track,\r\n    trigger\r\n}\r\n\r\n\r\n","import { hasOwn, isArray, isIntegerKey, isObject } from \"@vue/shared\"\r\nimport { track, trigger } from \"./effect\"\r\nimport { TrackOpTypes, TriggerOpTypes } from \"./operators\"\r\nimport { readonly, reactive } from \"./reactive\"\r\n\r\nfunction createGetter(isReadonly: boolean = false, isShallow: boolean = false) {\r\n    return function get(target: object, key: PropertyKey, receiver: any) {\r\n        const result = Reflect.get(target, key, receiver)\r\n        if (!isReadonly) {\r\n            // 依赖收集\r\n            track(target, TrackOpTypes.GET, key)\r\n        }\r\n\r\n        if (isShallow) {\r\n            return result\r\n        }\r\n\r\n        if (isObject(result)) {\r\n            return isReadonly ? readonly(result) : reactive(result)\r\n        }\r\n\r\n        return result\r\n    }\r\n}\r\n\r\n// 任意属性\r\ninterface ITarget {\r\n    [key: PropertyKey]: any\r\n}\r\nfunction createSetter(isShallow: boolean = false) {\r\n    return function set(target: ITarget, key: PropertyKey, value: any, receiver: any) {\r\n        const oldValue = target[key]\r\n        const hadKey =\r\n            // 是数组并且是修改数组索引\r\n            isArray(target) && isIntegerKey(key) ?\r\n                Number(key) < target.length :\r\n                hasOwn(target, key)\r\n\r\n        const result = Reflect.set(target, key, value, receiver)\r\n\r\n        if (!hadKey) {\r\n            // ADD\r\n            trigger(target, TriggerOpTypes.ADD, key, value)\r\n        } else if (oldValue !== value) {\r\n            // EDIT\r\n            trigger(target, TriggerOpTypes.UPDATE, key, value, oldValue)\r\n        }\r\n\r\n        return result\r\n    }\r\n}\r\n\r\nconst get = createGetter()\r\nconst shallowGet = createGetter(false, true)\r\nconst readonlyGet = createGetter(true)\r\nconst shallowReadonlyGet = createGetter(true, true)\r\n\r\nconst set = createSetter()\r\nconst shallowSet = createSetter(true)\r\n\r\n\r\nconst mutableHandlers = {\r\n    get,\r\n    set\r\n}\r\nconst shallowReactiveHandlers = {\r\n    get: shallowGet,\r\n    set: shallowSet\r\n}\r\nconst readonlyHandlers = {\r\n    get: readonlyGet,\r\n    set: (target: any, key: string) => {\r\n        console.warn(`set on key ${key} falied.`)\r\n    }\r\n}\r\nconst shallowReadonlyHandlers = {\r\n    get: shallowReadonlyGet,\r\n    set: (target: any, key: string) => {\r\n        console.warn(`set on key ${key} falied.`)\r\n    }\r\n}\r\n\r\n\r\nexport {\r\n    mutableHandlers,\r\n    shallowReactiveHandlers,\r\n    shallowReadonlyHandlers,\r\n    readonlyHandlers\r\n}","import { isObject } from '@vue/shared'\r\nimport {\r\n    mutableHandlers,\r\n    shallowReactiveHandlers,\r\n    shallowReadonlyHandlers,\r\n    readonlyHandlers\r\n} from './baseHandlers'\r\n\r\nconst reactiveMap = new WeakMap, readonlyMap = new WeakMap\r\n\r\nfunction createReactiveObject(target: any, isReadonly: boolean, baseHandlers: any) {\r\n    if (!isObject(target)) {\r\n        return target\r\n    }\r\n\r\n    const proxyMap = isReadonly ? readonlyMap : reactiveMap\r\n    // 已经代理过的对象直接返回\r\n    const existProxy = proxyMap.get(target)\r\n    if (existProxy) {\r\n        return existProxy\r\n    }\r\n\r\n    const proxy = new Proxy(target, baseHandlers)\r\n\r\n    proxyMap.set(target, proxy)\r\n\r\n    return proxy\r\n}\r\n\r\nexport function reactive(target: any) {\r\n    return createReactiveObject(target, false, mutableHandlers)\r\n}\r\nexport function shallowReactive(target: any) {\r\n    return createReactiveObject(target, false, shallowReactiveHandlers)\r\n}\r\nexport function readonly(target: any) {\r\n    return createReactiveObject(target, true, readonlyHandlers)\r\n}\r\nexport function shallowReadonly(target: any) {\r\n    return createReactiveObject(target, true, shallowReadonlyHandlers)\r\n}","import { isArray, isObject } from \"@vue/shared\"\r\nimport { track, trigger } from \"./effect\"\r\nimport { TrackOpTypes, TriggerOpTypes } from \"./operators\"\r\nimport { reactive } from \"./reactive\"\r\n\r\ntype RefValue = string | number | boolean | symbol | undefined | object\r\n\r\nfunction ref(value: RefValue) {\r\n    return createRef(value)\r\n}\r\n\r\nfunction shallowRef(value: RefValue) {\r\n    return createRef(value, true)\r\n}\r\n\r\nfunction createRef(rawValue: RefValue, isShollow: boolean = false) {\r\n    return new RefImpl(rawValue, isShollow)\r\n}\r\n\r\nconst convert = (value: RefValue) => isObject(value) ? reactive(value) : value\r\n\r\nclass RefImpl {\r\n    public _value: any;\r\n    public __v_isRef = true\r\n\r\n    constructor(\r\n        public rawValue: RefValue,\r\n        public isShollow: boolean = false\r\n    ) {\r\n        this._value = isShollow ? rawValue : convert(rawValue)\r\n    }\r\n\r\n    // `class` 中的 `get` 与 `set` 等价于 `Object.defineProperty`，\r\n    // `Object.defineProperty` 取值与设置值的时候需要一个公用的 _value 属性来进行操作\r\n    get value() {\r\n        track(this, TrackOpTypes.GET, 'value')\r\n        return this._value\r\n    }\r\n\r\n    set value(newValue) {\r\n        if (newValue !== this.rawValue) {\r\n            this.rawValue = newValue\r\n            this._value = this.isShollow ? newValue : convert(newValue)\r\n            trigger(this, TriggerOpTypes.UPDATE, 'value', newValue)\r\n        }\r\n    }\r\n}\r\n\r\nclass ObjectRefImpl {\r\n    public __v_isRef = true\r\n\r\n    constructor(public target: any, public key: PropertyKey) { }\r\n\r\n    get value() {\r\n        return this.target[this.key]\r\n    }\r\n\r\n    set value(newValue) {\r\n        this.target[this.key] = newValue\r\n    }\r\n}\r\n\r\nfunction toRef(target: any, key: PropertyKey) {\r\n    return new ObjectRefImpl(target, key)\r\n}\r\n\r\nfunction toRefs(target: any) {\r\n    const result: any = isArray(target) ? new Array(target.length) : {}\r\n    for (const key in target) {\r\n        result[key] = toRef(target, key)\r\n    }\r\n    return result\r\n}\r\n\r\nexport {\r\n    ref,\r\n    shallowRef,\r\n    toRef,\r\n    toRefs\r\n}\r\n","import { isFunction } from \"@vue/shared\";\r\nimport { effect, track, trigger } from \"./effect\";\r\nimport { TrackOpTypes, TriggerOpTypes } from \"./operators\";\r\n\r\nclass ComputedRefImpl {\r\n    public _dirty = true // 默认取值不用缓存的\r\n    public _value: any\r\n    public effect: any\r\n\r\n    constructor(\r\n        public getter: () => {},\r\n        public setter: (p1: any) => {}\r\n    ) {\r\n        this.effect = effect(\r\n            getter,\r\n            {\r\n                lazy: true,\r\n                scheduler: () => {\r\n                    if (!this._dirty) {\r\n                        this._dirty = true\r\n                        trigger(this, TriggerOpTypes.UPDATE, 'value')\r\n                    }\r\n                }\r\n            }\r\n        )\r\n    }\r\n\r\n    get value() {\r\n        if (this._dirty) {\r\n            this._value = this.effect()\r\n            this._dirty = false\r\n        }\r\n        track(this, TrackOpTypes.GET, 'value')\r\n        return this._value\r\n    }\r\n\r\n    set value(newValue) {\r\n        this.setter(newValue)\r\n    }\r\n}\r\n\r\n// 1、默认不执行，当访问属性的时候执行\r\n// 2、依赖的值不变，不会去重新计算，一直用缓存的值\r\n// 3、依赖的值变了，也不会去重新计算，当再次调用该计算属性值才重新计算\r\n// 4、effect(()=>{},{lazy:true}) + scheduler + 缓存标志\r\nexport function computed(getterOrOptions: any) {\r\n    let getter, setter\r\n\r\n    if (isFunction(getterOrOptions)) {\r\n        getter = getterOrOptions\r\n        setter = () => {\r\n            console.warn('computed value must be readonly')\r\n        }\r\n    } else {\r\n        getter = getterOrOptions.getter\r\n        setter = getterOrOptions.setter\r\n    }\r\n\r\n    return new ComputedRefImpl(getter, setter)\r\n}\r\n\r\n"],"names":[],"mappings":"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"}